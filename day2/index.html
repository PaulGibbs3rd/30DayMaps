<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location History Map</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/themes/light/main.css">
    <style>
        html, body, #viewDiv, #timeSliderDiv {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        #timeSliderDiv {
            position: absolute;
            bottom: 10px;
            left: 20px;
            width: 90%;
            background-color: white;
            padding: 10px;
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.3);
            z-index: 99;
        }
    </style>
    <script src="https://js.arcgis.com/4.30/"></script>
</head>
<body>
    <div id="viewDiv"></div>
    <div id="timeSliderDiv"></div>
    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/GeoJSONLayer",
            "esri/widgets/TimeSlider"
        ], function(Map, MapView, GeoJSONLayer, TimeSlider) {

            // URL to point GeoJSON file hosted in the repository
            const pointLayerUrl = "https://raw.githubusercontent.com/PaulGibbs3rd/30DayMaps/main/day2/LocationHistor_FeaturesToJSO.geojson";

            // URL to polyline GeoJSON file hosted in the repository
            const polylineLayerUrl = "https://raw.githubusercontent.com/PaulGibbs3rd/30DayMaps/main/day2/LocationHistoryPolyline_FeaturesToJSO.geojson";

            // GeoJSON layer for Points with unique value renderer
            const pointLayer = new GeoJSONLayer({
                url: pointLayerUrl,
                renderer: {
                    type: "unique-value",
                    field: "type",  // Unique value field for points
                    uniqueValueInfos: [
                        {
                            value: "Start",
                            symbol: {
                                type: "simple-marker",
                                style: "circle",
                                color: "green",
                                size: 6,
                                outline: {
                                    width: 1,
                                    color: "white"
                                }
                            },
                            label: "Start Point"
                        },
                        {
                            value: "End",
                            symbol: {
                                type: "simple-marker",
                                style: "circle",
                                color: "red",
                                size: 6,
                                outline: {
                                    width: 1,
                                    color: "white"
                                }
                            },
                            label: "End Point"
                        }
                    ]
                },
                timeInfo: {
                    startField: "startDate",  // Replace with the correct start date field in your GeoJSON
                    endField: "endDate"       // Replace with the correct end date field in your GeoJSON
                },
                popupTemplate: {
                    title: "Location Point",
                    content: "<b>Type:</b> {type}<br><b>Start Date:</b> {startDate}<br><b>End Date:</b> {endDate}"
                }
            });

            // GeoJSON layer for Polylines with unique value renderer
            const polylineLayer = new GeoJSONLayer({
                url: polylineLayerUrl,
                renderer: {
                    type: "unique-value",
                    field: "type_change",  // Unique value field for polylines
                    uniqueValueInfos: [
                        {
                            value: "Move",
                            symbol: {
                                type: "simple-line",
                                color: "blue",
                                width: 2
                            },
                            label: "Movement Path"
                        },
                        {
                            value: "Stop",
                            symbol: {
                                type: "simple-line",
                                color: "orange",
                                width: 2
                            },
                            label: "Stop Path"
                        }
                    ]
                },
                timeInfo: {
                    startField: "startDate",  // Replace with the correct start date field in your GeoJSON
                    endField: "endDate"       // Replace with the correct end date field in your GeoJSON
                },
                popupTemplate: {
                    title: "Movement Path",
                    content: "<b>Type Change:</b> {type_change}<br><b>Start Date:</b> {startDate}<br><b>End Date:</b> {endDate}"
                }
            });

            // Create the map
            const map = new Map({
                basemap: "streets-navigation-vector",
                layers: [pointLayer, polylineLayer]
            });

            // Create the view
            const view = new MapView({
                container: "viewDiv",
                map: map,
                center: [-100.33, 25.69], // Adjust center coordinates as per your data's location
                zoom: 5
            });

            // Add the TimeSlider widget
            const timeSlider = new TimeSlider({
                container: "timeSliderDiv",
                view: view,
                timeVisible: true,  // Shows the time stamps on the time slider
                stops: {
                    interval: {
                        value: 1,
                        unit: "days"
                    }
                }
            });

            // Wait until the view is ready to set the time extent
            view.whenLayerView(pointLayer).then(function() {
                pointLayer.when(() => {
                    const fullTimeExtent = pointLayer.timeInfo.fullTimeExtent;
                    timeSlider.fullTimeExtent = fullTimeExtent;
                    timeSlider.values = [fullTimeExtent.start, fullTimeExtent.end];
                });
            });
        });
    </script>
</body>
</html>
